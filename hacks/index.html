<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="forking in nodejs, simple timing in node, pretty sleep using nodejs, hp folio 13 wifi hack, deploy part 2, installing mysql on centos6, httperfrb perf example, curl https inscure, kill capslock, zsh known hosts completion, thin wrapper, rails script server unicorn replacement, bash version checking, gistcli, deploy, ghpages, bash arrays" name="keywords">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="" name="author">
<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="//cdn.mervine.net/bootstrap/master.css" media="screen" rel="stylesheet">
<!--[if lte IE 6]>
      <link href='http://universal-ie6-css.googlecode.com/files/ie6.1.1.css' media='screen, projection' rel='stylesheet'>
    <![endif]--><!--[if lt IE 9]>
      <script src='//html5shim.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]--><link href="/articles.xml" rel="alternate" type="application/atom+xml">
<link href="//cdn.mervine.net/bootstrap/favicon.ico" rel="shortcut icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon.png" rel="apple-touch-icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">
<title>Hacks - mervine.net</title>
</head>
<body style="padding-top: 10px !important">
    <div class="container">
      <div class="navbar navbar-default navbar-top" style="margin-bottom: 0px !important">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Home</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
<li class="">
              <a href="http://mervine.net/categories">Category List</a>
            </li>
            <li class="">
              <a href="http://mervine.net/projects">My Projects</a>
            </li>
            <li class="">
              <a href="http://mervine.net/notes">Notes</a>
            </li>
            <li class="active">
              <a href="http://mervine.net/hacks">Hacks</a>
            </li>
            <li class="">
              <a href="http://mervine.net/quotes">Quotes</a>
            </li>
            <li class="">
              <a href="http://mervine.net/archive">Archives</a>
            </li>
          </ul>
<ul class="nav navbar-nav navbar-right visible-xs">
<li>
              <a href="http://twitter.com/mervinej">Twitter</a>
            </li>
            <li>
              <a href="http://linkedin.com/in/mervinej">Linkedin</a>
            </li>
            <li>
              <a href="http://github.com/jmervine">Github</a>
            </li>
            <li>
              <a href="http://www.gittip.com/jmervine">Gittip</a>
            </li>
          </ul>
</div>
      </div>
      <div class="container">
        <div class="page-header" style="margin-top: 0px !important;">
          <img src="http://www.gravatar.com/avatar/ed808193b8c2c8516715816f90a005b2.jpg?s=75" style="padding:5px 15px 15px; float:left"><a href="http://mervine.net/">
            <h1>mervine.net</h1>
          </a><small>Lessons learned, code written, hacks, etc.</small>
        </div>
      </div>
      <div class="container">
        <div class="col-sm-12 col-md-9">
          <div class="page_content container">
  <div class="page_content">
    <h1>Hacks</h1>
    
    <p>A place to save and share all the nasty little hacks that make the world go round and round.</p>
    
    <blockquote>
<p>The word "hacker" has an unfairly negative connotation from being portrayed in the media as people who break into computers. In reality, hacking just means building something quickly or testing the boundaries of what can be done. Like most things, it can be used for good or bad, but the vast majority of hackers Iâ€™ve met tend to be idealistic people who want to have a positive impact on the world.</p>
    
    <p>Mark Zuckerberg</p>
</blockquote>
    <hr class="article_seperator">
<header><h2>Articles on Hacks</h2>
    </header><div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/forking-in-nodejs">Forking in Node.js / Threading HTTPerf with HTTPerf.js</a>
    </h2>
  </header><p>Occasionally, we want to generate load beyond what a single httperf thread can handle, especially when working in <a href="http://nodejs.org/">Node.js</a>, where the connection limits can get very high. The code sample below does that, but also serves as an example of how to use the <a href="http://nodejs.org/api/cluster.html">cluster module</a> to fork actions and collect the resulting data. Enjoy!</p>
  <p class="read_more">
    <a href="http://mervine.net/hacks/forking-in-nodejs">Continue reading</a>
  </p>
  <footer><p class="meta">
      Published
      on
      <time datetime="2014-02-26T22:00:00+00:00" pubdate>26 February 2014</time>
      in
      <a href="http://mervine.net/hacks">Hacks</a>,
      <a href="http://mervine.net/httperf">Httperf</a>,
      <a href="http://mervine.net/nodejs">Node.js</a>
    </p>
  </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/notes/simple-timing-in-node">Simple Timing in Node.js</a>
    </h2>
  </header><p>I just stumbled upon a cool feature of <a href="http://nodejs.org/">Node.js</a> for adding timing to applications using <code>console.time</code> and console.timeEnd`.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">//</span> pointless example that show all parts</span>
<span class="Entity">console</span><span class="SupportFunction">.time</span>(<span class="String"><span class="String">'</span>timer<span class="String">'</span></span>);
<span class="SupportFunction">setTimeout</span>(<span class="Storage">function</span>() {
    <span class="Entity">console</span><span class="SupportFunction">.timeEnd</span>(<span class="String"><span class="String">'</span>timer<span class="String">'</span></span>);
}, <span class="Constant">500</span>);

<span class="Comment"><span class="Comment">//</span> =&gt; timer: 511ms</span>
</pre>

<blockquote><p>Note: I've heard (and in somecases proven) that in most cases <code>console.</code> method are not asynchronous (i.e. blocking) and therefore should never be used in production code. Notice that in the above example, <code>console.time</code> and <code>console.timeEnd</code> appear to have about 11ms of overhead on my machine.</p></blockquote>
  <footer><p class="meta">
      Published
      on
      <time datetime="2014-01-06T20:00:00+00:00" pubdate>06 January 2014</time>
      in
      <a href="http://mervine.net/hacks">Hacks</a>,
      <a href="http://mervine.net/nodejs">Node.js</a>,
      <a href="http://mervine.net/notes">Notes</a>
    </p>
  </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/pretty-sleep-using-nodejs">Pretty Sleep using Node.js</a>
    </h2>
  </header><pre class="twilight"><span class="Keyword">$</span> node <span class="Keyword">-</span>e <span class="String"><span class="String">'</span>n=0; setInterval(function(){n++;if(n&gt;=20){console.log(".");process.exit(0);}process.stdout.write(".");},1000);<span class="String">'</span></span>
</pre>
  <footer><p class="meta">
        Published
        on
        <time datetime="2013-08-16T10:30:00+00:00" pubdate>16 August 2013</time>
        in
        <a href="http://mervine.net/bash">Bash</a>,
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>,
        <a href="http://mervine.net/nodejs">Node.js</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/hp-folio-13-wifi-hack">WiFi/Bluetooth Hack for the HP Folio 13</a>
    </h2>
  </header><p>Someone asked for this recently, I'm not going to go in to great detail at this time, but I found it while looking through <a href="http://gist.github.com/jmervine">my gists</a> and thought I would share.</p>

<p>Simple replace your <code>/etc/rc.local</code> with the following and it should unlock the hardware airplane mode on startup.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span>!/bin/sh -e</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> rc.local</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> This script is executed at the end of each multiuser runlevel.</span>
<span class="Comment"><span class="Comment">#</span> Make sure that the script will "exit 0" on success or any other</span>
<span class="Comment"><span class="Comment">#</span> value on error.</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> In order to enable or disable this script just change the execution</span>
<span class="Comment"><span class="Comment">#</span> bits.</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> By default this script does nothing.</span>

rfkill unblock wifi
sleep 5
rmmod -w -s hp-wmi
<span class="Comment"><span class="Comment">#</span>modprobe -r -s hp-wmi</span>

exit 0
</pre>

<p><a href="https://gist.github.com/jmervine/4077523">get the gist</a></p>
  <footer><p class="meta">
        Published
        on
        <time datetime="2013-06-29T11:30:00+00:00" pubdate>29 June 2013</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>,
        <a href="http://mervine.net/notes">Notes</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/deploy-part-2">Hack: Deploying with git and rake-remote_task</a>
    </h2>
  </header><blockquote><p>This is an update to my previous post: <a href="/hacks/deploy">Hack: Deploying with git</a>, replacing the use of pure <a href="/rake">rake</a>, for <a href="https://github.com/seattlerb/rake-remote_task">rake-remote_task</a>.</p></blockquote>

<p>Add the following to your Rakefile</p>

<pre class="twilight">require <span class="String"><span class="String">'</span>rake/remote_task<span class="String">'</span></span>

set :domain,      ENV.fetch(PRODUCTION_HOST, <span class="String"><span class="String">"</span>www.yourhost.com<span class="String">"</span></span>)
set :environment, ENV.fetch(RACK_ENV,        <span class="String"><span class="String">"</span>production<span class="String">"</span></span>)

set :app_path,    <span class="String"><span class="String">"</span>/path/to/app/install<span class="String">"</span></span>

remote_task :deploy <span class="Keyword">do</span>
  run <span class="String"><span class="String">"</span>set -x; cd #{app_path} &amp;&amp; git pull &amp;&amp; bundle<span class="String">"</span></span>
end

remote_task :restart <span class="Keyword">do</span>
  run <span class="String"><span class="String">"</span>set -x; cd #{app_path} &amp;&amp; RACK_ENV=#{environment} bundle exec rake unicorn:restart --trace<span class="String">"</span></span>
end
</pre>

<p>Then run</p>

<pre class="twilight">$ RACK_ENV=production PRODUCTION_HOST=www.foohost.com bundle exec rake deploy restart
</pre>

<p>or just</p>

<pre class="twilight">$ RACK_ENV=production PRODUCTION_HOST=www.foohost.com bundle exec rake deploy
</pre>

<p><strong>Note -- This assumes the following: </strong></p>

<ul>
<li>You've checked out your repo on your remote host.</li>
<li>You've setup your app and it's running on your remote server.</li>
<li>You're using using <a href="https://github.com/defunkt/unicorn">Unicorn</a>.</li>
<li>You're using <a href="http://gembundler.com/">Bundler</a>.</li>
</ul>
<footer><p class="meta">
        Published
        on
        <time datetime="2013-06-03T21:00:00+00:00" pubdate>03 June 2013</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/rake">Rake</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/installing-mysql-on-centos6">Install MySQL on CentOS 6</a>
    </h2>
  </header><p>A simple script to install MySQL on CentOS 6.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span>!/usr/bin/bash</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> sudo bash &lt; &lt;(curl -s https://gist.github.com/jmervine/5373441/raw/)</span>

set -x
cd /tmp
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-shared-5.6.10-1.el6.x86_64.rpm/from/http://cdn.mysql.com/
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-client-5.6.10-1.el6.x86_64.rpm/from/http://cdn.mysql.com/
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-server-5.6.10-1.el6.x86_64.rpm/from/http://cdn.mysql.com/
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-devel-5.6.10-1.el6.i686.rpm/from/http://cdn.mysql.com/

rpm -qa <span class="Keyword">|</span> grep mysql-libs <span class="Keyword">&amp;&amp;</span> yum remove -y mysql-libs

yum install -y MySQL-shared-5.6.10-1.el6.x86_64.rpm
yum install -y MySQL-client-5.6.10-1.el6.x86_64.rpm
yum install -y MySQL-server-5.6.10-1.el6.x86_64.rpm
yum install -y MySQL-devel-5.6.10-1.el6.i686.rpm
</pre>

<p><a href="https://gist.github.com/jmervine/5373441">Link to gist.</a></p>
  <footer><p class="meta">
        Published
        on
        <time datetime="2013-04-12T10:00:00+00:00" pubdate>12 April 2013</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>,
        <a href="http://mervine.net/notes">Notes</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/httperfrb-perf-example">HTTPerf.rb Example</a>
    </h2>
  </header><p>Here's an example of a simple script using HTTPerb.rb. It's a quick and dirty script used for getting quick differences between changes.</p>
  <p class="read_more">
    <a href="http://mervine.net/httperfrb-perf-example">Continue reading</a>
  </p>
  <footer><p class="meta">
        Published
        on
        <time datetime="2013-04-09T20:00:00+00:00" pubdate>09 April 2013</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/httperf">Httperf</a>,
        <a href="http://mervine.net/httperfrb">HTTPerf.rb</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/curl-https-inscure">Using curl to Test HTTPS with Self Signed Certs</a>
    </h2>
  </header><pre class="twilight">$ curl https://<span class="Keyword">&lt;</span>domain<span class="Keyword">&gt;</span>/path/to.html --insecure
</pre>

<blockquote><p>Also see: <a href="/https-self-signed-certs">HTTPS: Creating Slef-signed Certs</a>.</p></blockquote>
  <footer><p class="meta">
        Published
        on
        <time datetime="2013-03-28T16:00:00+00:00" pubdate>28 March 2013</time>
        in
        <a href="http://mervine.net/bash">Bash</a>,
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/kill-capslock">Killing Caps Lock on Ubuntu</a>
    </h2>
  </header><ol>
<li>
<p>Create <code>xmodmap</code> file:</p>

<pre class="twilight"> $ xmodmap -pke &gt; ~/.xmodmap
</pre>
</li>
<li>
<p>Edit the newly created <code>~/.xmodmap</code> file, changing the line starting with <code>keycode 66 =</code> to map to a key of your choice. Here's an example where I'm mapping Caps Lock to the Escape key:</p>

<pre class="twilight"> keycode  66 = Escape NoSymbol Escape
</pre>
</li>
<li>
<p>Load your new map, disabling Caps Lock:</p>

<pre class="twilight"> xmodmap ~/.xmodmap
</pre>
</li>
<li>
<p>(optionally) You can set this to autostart when you launch Unity by creating the following file:</p>

<pre class="twilight"> $ cat .config/autostart/xmodmap.desktop
 [Desktop Entry]
 Type=Application
 Exec=xmodmap ~/.xmodmap
 Hidden=false
 NoDisplay=false
 X-GNOME-Autostart-enabled=true
 Name[en_US]=xmodmap
 Name=xmodmap
 Comment[en_US]=
 Comment=
</pre>
</li>
</ol>
<footer><p class="meta">
        Published
        on
        <time datetime="2012-11-14T22:00:00+00:00" pubdate>14 November 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/zsh-known-hosts-completion">Fast Hostname Completion with ZSH</a>
    </h2>
  </header><blockquote><p>Credit goes to this post for this: <a href="http://nion.modprobe.de/blog/archives/521-hostname-completion-with-zsh.html">http://nion.modprobe.de/blog/archives/521-hostname-completion-with-zsh.html</a></p></blockquote>

<p>In your ~/.zshrc</p>

<pre class="twilight">local knownhosts
knownhosts=( ${${${${(f)"$(&lt;$HOME/.ssh/known_hosts)"}:#[0-9]*}%%\ *}%%,*} )
zstyle ':completion:*:(ssh|scp|sftp):*' hosts $knownhosts
</pre>

<p>In your ~/.ssh/config</p>

<pre class="twilight">HashKnownHosts no
</pre>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-10-23T18:30:00+00:00" pubdate>23 October 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>,
        <a href="http://mervine.net/zsh">ZSH</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/thin-wrapper">Thin Wrapper Script</a>
    </h2>
  </header><p>Their may be others, there may be better, but this is mine.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> file: APP_ROOT/thin.sh</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span>!/usr/bin/env bash</span>
<span class="Comment"><span class="Comment">#</span> source config if present</span>
test -f ./config/thinrc <span class="Keyword">&amp;&amp;</span> source ./config/thinrc

<span class="Comment"><span class="Comment">#</span> set up primary defaults</span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>RACK_ENV</span><span class="String">"</span></span>  <span class="Keyword">||</span> RACK_ENV=<span class="String"><span class="String">"</span>development<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_PORT</span><span class="String">"</span></span> <span class="Keyword">||</span> THIN_PORT=<span class="String"><span class="String">"</span>4321<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_PID</span><span class="String">"</span></span>  <span class="Keyword">||</span> THIN_PID=<span class="String"><span class="String">"</span>./log/listener.pid<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_LOG</span><span class="String">"</span></span>  <span class="Keyword">||</span> THIN_LOG=<span class="String"><span class="String">"</span>./log/listener.log<span class="String">"</span></span>

test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>DEBUG</span><span class="String">"</span></span>     <span class="Keyword">&amp;&amp;</span> set -x

<span class="Keyword">if</span> <span class="Keyword">!</span> test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>1</span><span class="String">"</span></span>
<span class="Keyword">then</span>
    echo <span class="String"><span class="String">"</span>Usage: listener start|stop|restart<span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span> <span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>Takes the following overides as environemnt variables:<span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span> <span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>  RACK_ENV  :: default <span class="StringVariable"><span class="StringVariable">$</span>RACK_ENV</span><span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>  THIN_PORT :: default <span class="StringVariable"><span class="StringVariable">$</span>THIN_PORT</span><span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>  THIN_PID  :: default <span class="StringVariable"><span class="StringVariable">$</span>THIN_PID</span><span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>  THIN_LOG  :: default <span class="StringVariable"><span class="StringVariable">$</span>THIN_LOG</span><span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span> <span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span>Takes config file as './config/thinrc' with overides above. <span class="String">"</span></span>
    echo <span class="String"><span class="String">"</span> <span class="String">"</span></span>
    exit 0
<span class="Keyword">fi</span>

RACK_ENV=<span class="Variable"><span class="Variable">$</span>RACK_ENV</span> thin --port <span class="Variable"><span class="Variable">$</span>THIN_PORT</span> --pid <span class="Variable"><span class="Variable">$</span>THIN_PID</span> --log <span class="Variable"><span class="Variable">$</span>THIN_LOG</span> --daemonize <span class="Variable"><span class="Variable">$</span>1</span>

<span class="Comment"><span class="Comment">#</span> vim: set filetype=sh</span>
</pre>

<p><em><a href="https://gist.github.com/3928518">gist</a></em></p>

<br><p>And if you need external configs...</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> file: APP_ROOT/config/thinrc</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> Directory pathing context should be that of the thin</span>
<span class="Comment"><span class="Comment">#</span> init script sourcing this file, not this file itself.</span>
<span class="Comment"><span class="Comment">#</span></span>
<span class="Comment"><span class="Comment">#</span> allow for overides as such</span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>RACK_ENV</span><span class="String">"</span></span>  <span class="Keyword">||</span> RACK_ENV=<span class="String"><span class="String">"</span>production<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_PORT</span><span class="String">"</span></span> <span class="Keyword">||</span> THIN_PORT=<span class="String"><span class="String">"</span>4321<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_PID</span><span class="String">"</span></span>  <span class="Keyword">||</span> THIN_PID=<span class="String"><span class="String">"</span>./log/listener.pid<span class="String">"</span></span>
test <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">$</span>THIN_LOG</span><span class="String">"</span></span>  <span class="Keyword">||</span> THIN_LOG=<span class="String"><span class="String">"</span>./log/listener.log<span class="String">"</span></span>

<span class="Comment"><span class="Comment">#</span> force defaults as such</span>
<span class="Comment"><span class="Comment">#</span>RACK_ENV="development"</span>
<span class="Comment"><span class="Comment">#</span>THIN_PORT="4321"</span>
<span class="Comment"><span class="Comment">#</span>THIN_PID="./log/listener.pid"</span>
<span class="Comment"><span class="Comment">#</span>THIN_LOG="./log/listener.log"</span>

<span class="Comment"><span class="Comment">#</span> vim: set filetype=sh</span>
</pre>

<p><em><a href="https://gist.github.com/3928518">gist</a></em></p>

<h4><a href="http://code.macournoyer.com/thin/">What is Thin?</a></h4>

<br><footer><p class="meta">
        Published
        on
        <time datetime="2012-10-21T19:30:00+00:00" pubdate>21 October 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/rails-script-server-unicorn-replacement">Rails script/server Unicorn Replacement</a>
    </h2>
  </header><p>A script to replace <code>script/server</code> in Rails, which runs Unicorn over Webrick, because it's faster. This script is designed for <strong>development only</strong>!</p>
  <p class="read_more">
    <a href="http://mervine.net/hacks/rails-script-server-unicorn-replacement">Continue reading</a>
  </p>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-10-19T18:30:00+00:00" pubdate>19 October 2012</time>
        in
        <a href="http://mervine.net/bash">Bash</a>,
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/bash-version-checking">Minimum Version Checking with BASH/ZSH</a>
    </h2>
  </header><h4>Thanks to <a href="https://twitter.com/retr0h">@retr0h</a>:</h4>

<pre class="twilight">[[ <span class="String"><span class="String">$(</span>zsh --version <span class="Keyword">|</span> awk <span class="String"><span class="String">'</span>{print $2}<span class="String">'</span></span><span class="String">)</span></span> <span class="Keyword">&gt;</span> 4.3.17 ]]

<span class="Comment"><span class="Comment">#</span> usage</span>

<span class="Keyword">if</span> [[ <span class="String"><span class="String">$(</span>zsh --version <span class="Keyword">|</span> awk <span class="String"><span class="String">'</span>{print $2}<span class="String">'</span></span><span class="String">)</span></span> <span class="Keyword">&gt;</span> 4.3.17 ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    <span class="Comment"><span class="Comment">#</span> do someting that only higher zsh versions support</span>
<span class="Keyword">else</span>
    <span class="Comment"><span class="Comment">#</span> do something else for low versions</span>
<span class="Keyword">fi</span>
</pre>

<hr>
<blockquote>
<p>This was my origitional (not so sexy solution).</p>

<p>The following line will print <code>zsh</code> version information if the version is greater then or equal to 4.3.17, otherwise it will return blank:</p>

<pre class="twilight">zsh --version <span class="Keyword">|</span> awk <span class="String"><span class="String">'</span>{print $2}<span class="String">'</span></span> <span class="Keyword">|</span> awk -F<span class="String"><span class="String">'</span>.<span class="String">'</span></span> <span class="String"><span class="String">'</span> ( $1 &gt; 4 || ( $1 == 4 &amp;&amp; $2 &gt; 3 ) || ( $1 == 4 &amp;&amp; $2 == 3 &amp;&amp; $3 &gt;= 17 ) ) <span class="String">'</span></span>
</pre>

<p>An example usage would be something like:</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span>!/usr/bin/env bash</span>
<span class="Keyword">if</span> test <span class="String"><span class="String">"</span><span class="String"><span class="String">$(</span> zsh --version <span class="Keyword">|</span> awk <span class="String"><span class="String">'</span>{print $2}<span class="String">'</span></span> <span class="Keyword">|</span> awk -F<span class="String"><span class="String">'</span>.<span class="String">'</span></span> <span class="String"><span class="String">'</span> ( $1 &gt; 4 || ( $1 == 4 &amp;&amp; $2 &gt; 3 ) || ( $1 == 4 &amp;&amp; $2 == 3 &amp;&amp; $3 &gt;= 17 ) ) <span class="String">'</span></span> <span class="String">)</span></span><span class="String">"</span></span>
<span class="Keyword">then</span>
    <span class="Comment"><span class="Comment">#</span> do someting that only higher zsh versions support</span>
<span class="Keyword">else</span>
    <span class="Comment"><span class="Comment">#</span> do something else for low versions</span>
<span class="Keyword">fi</span>
</pre>
</blockquote>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-10-19T12:00:00+00:00" pubdate>19 October 2012</time>
        in
        <a href="http://mervine.net/bash">Bash</a>,
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>,
        <a href="http://mervine.net/zsh">ZSH</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/gistcli">Web Pasting with "gistcli"</a>
    </h2>
  </header><p><a href="https://github.com/pranavk/gist-cli">Found this simple Python script which allows for cli gist posts</a> -- (thanks to <a href="http://github.com/pranavk">pranavk</a>).</p>

<p>You can install it like so</p>

<pre class="twilight">$ mkdir ~/bin
$ echo "export PATH=~/bin:$PATH" &gt;&gt; ~/.zshrc
$ cd ~/bin
$ wget https://raw.github.com/pranavk/gist-cli/master/gistcli
$ chmod 755 gistcli
$ source ~/.zshrc
</pre>

<p>Usage examples</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> simple echo to gist</span>
echo <span class="String"><span class="String">"</span>test gist<span class="String">"</span></span> <span class="Keyword">|</span> gistcli

<span class="Comment"><span class="Comment">#</span> file to gist</span>
gistcli -f myfile.txt

<span class="Comment"><span class="Comment">#</span> private</span>
echo <span class="String"><span class="String">"</span>ssssh, don't tell anyone!<span class="String">"</span></span> <span class="Keyword">|</span> gistcli -p

<span class="Comment"><span class="Comment">#</span> from tty, EOF from '.' on it's own line</span>
gistcli -
Foo, bar bah bing<span class="Keyword">!</span>
.
</pre>

<blockquote><p>Note:
There's also a slightly more mature <a href="/ruby">Ruby</a> gist cli tool at <a href="https://github.com/defunkt/gist">github.com/defunkt/gist</a> but I had issues getting it to work with my RMV setup.</p></blockquote>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-09-23T17:35:00+00:00" pubdate>23 September 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/deploy">Hack: Deploying with git</a>
    </h2>
  </header><blockquote><p>This has been updated, see: <a href="/hacks/deploy-part-2">Hack: Deploying with git and rake-remote_remote</a></p></blockquote>

<p>Add the following to your Rakefile</p>

<pre class="twilight">ENV[<span class="String"><span class="String">'</span>PRODUCTION_HOST<span class="String">'</span></span>] <span class="Keyword">||</span>= <span class="String"><span class="String">"</span>www.yourhost.com<span class="String">"</span></span>
task :deploy <span class="Keyword">do</span>
  system(<span class="String"><span class="String">"</span>ssh #{PRODUCTION_HOST} 'set -x; cd /path/to/app/install &amp;&amp; git pull &amp;&amp; bundle'<span class="String">"</span></span>)
end

desc <span class="String"><span class="String">"</span>restart production<span class="String">"</span></span> 
task :restart <span class="Keyword">do</span>
  system(<span class="String"><span class="String">"</span>ssh #{PRODUCTION_HOST} 'set -x; cd /path/to/app/install &amp;&amp; RACK_ENV=#{ENV['RACK_ENV']} bundle exec rake unicorn:restart --trace'<span class="String">"</span></span>)
end
</pre>

<p>Then run</p>

<pre class="twilight">$ RACK_ENV=production PRODUCTION_HOST=www.foohost.com bundle exec rake deploy restart
</pre>

<p>or just</p>

<pre class="twilight">$ RACK_ENV=production PRODUCTION_HOST=www.foohost.com bundle exec rake deploy
</pre>

<p><strong>Note -- This assumes the following: </strong></p>

<ul>
<li>You've checked out your repo on your remote host.</li>
<li>You've setup your app and it's running on your remote server.</li>
<li>You're using using <a href="https://github.com/defunkt/unicorn">Unicorn</a>.</li>
<li>You're using <a href="http://gembundler.com/">Bundler</a>.</li>
</ul>
<footer><p class="meta">
        Published
        on
        <time datetime="2012-09-20T16:00:00+00:00" pubdate>20 September 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/rake">Rake</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/hacks/ghpages">Hack: Generating gh-pages</a>
    </h2>
  </header><h3>With rake</h3>

<p>Add the following to your Rakefile</p>

<pre class="twilight">desc <span class="String"><span class="String">"</span>generate and update gh-pages<span class="String">"</span></span>
task <span class="Constant"><span class="Constant">:</span>pages</span> <span class="Keyword">do</span>
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; bundle exec rspec <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; bundle exec yardoc --protected ./lib/**/*.rb <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; mv -v ./doc /tmp <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; mv -v ./coverage /tmp <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; git checkout gh-pages <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; rm -rf ./doc ./coverage <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; mv -v /tmp/doc . <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; mv -v /tmp/coverage . <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; git add . <span class="String">"</span></span>) <span class="Keyword">or</span> abort 
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; git commit --all -m 'updating doc and coverage' <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  <span class="Entity">system</span>(<span class="String"><span class="String">"</span> set -x; git checkout master <span class="String">"</span></span>) <span class="Keyword">or</span> abort
  puts <span class="String"><span class="String">"</span>don't forget to run: git push origin gh-pages<span class="String">"</span></span>
<span class="Keyword">end</span>
</pre>

<p>Then run</p>

<pre class="twilight">$ bundle exec rake pages
$ git push gh-pages
</pre>

<h3>Or less ugly, with bash...</h3>

<p>Create <code>scripts/pages</code></p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span>!/usr/bin/env bash</span>
set -xue 
bundle exec rspec 
bundle exec yardoc --protected ./lib/**/*.rb
mv -v ./doc /tmp 
mv -v ./coverage /tmp 
git checkout gh-pages
rm -rf ./doc ./coverage 
mv -v /tmp/doc .
mv -v /tmp/coverage . 
git add .
git commit --all -m <span class="String"><span class="String">'</span>updating doc and coverage<span class="String">'</span></span>
git checkout master
echo <span class="String"><span class="String">"</span>don't forget to run: git push origin gh-pages<span class="String">"</span></span>
</pre>

<p>Then run</p>

<pre class="twilight">$ chmod 755 ./scripts/pages
$ ./scripts/pages
</pre>

<blockquote><p>Note -- I opted for the rake method because I use rake in my projects.</p></blockquote>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-09-20T15:30:00+00:00" pubdate>20 September 2012</time>
        in
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/rake">Rake</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer>
</div>
<div class="well" style="padding-top: 0px; padding-bottom: 0px">
  <header><h2>
      <a href="http://mervine.net/bash-arrays">BASH Arrays</a>
    </h2>
  </header><p>Basic Array handling in BASH, because I always forget.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> basic itteration</span>
items=( a b c d e )

<span class="Keyword">for</span> i <span class="Keyword">in</span> <span class="String"><span class="String">"</span><span class="StringVariable"><span class="StringVariable">${</span>items[@]<span class="StringVariable">}</span></span><span class="String">"</span></span>
<span class="Keyword">do</span>
    echo -n <span class="Variable"><span class="Variable">$</span>i</span>
<span class="Keyword">done</span>

<span class="Comment"><span class="Comment">#</span>=&gt; abcde</span>

<span class="Comment"><span class="Comment">#</span> update specific array slot</span>
items[1]=<span class="String"><span class="String">"</span>foo<span class="String">"</span></span>

<span class="Comment"><span class="Comment">#</span> access specific array slot</span>
echo <span class="Variable"><span class="Variable">${</span>items[1]<span class="Variable">}</span></span>

<span class="Comment"><span class="Comment">#</span>=&gt; foo</span>
</pre>
  <footer><p class="meta">
        Published
        on
        <time datetime="2012-05-30T00:32:00+00:00" pubdate>30 May 2012</time>
        in
        <a href="http://mervine.net/bash">Bash</a>,
        <a href="http://mervine.net/hacks">Hacks</a>,
        <a href="http://mervine.net/linux">Linux</a>
      </p>
    </footer>
</div>
    
    <hr class="article_seperator">
<br><div id="disqus_thread">
      <script async src="http://rubyops.disqus.com/embed.js" type="text/javascript"></script><noscript>
        <a href="http://rubyops.disqus.com/embed.js?url=ref">View comments.</a>
      </noscript>
    </div>
  </div>
</div>
        </div>
        <div class="col-md-3 visible-md visible-lg">
          <div class="sidebar-nav">
              <ul class="share-buttons">
<li>
                  <a href="https://www.facebook.com/sharer/sharer.php?u=http://mervine.net/hacks" target="_blank">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Facebook.png"></a>
                </li>
                <li>
                  <a href="https://twitter.com/intent/tweet?url=http://mervine.net/hacks&amp;text=Hacks%20-%20mervine.net%20-%20&amp;via=mervinej" target="_blank" title="Tweet">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Twitter.png"></a>
                </li>
                <li>
                  <a href="https://plus.google.com/share?url=http://mervine.net/hacks" target="_blank" title="Share on Google+">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Google.png"></a>
                </li>
                <li>
                  <a href="http://www.reddit.com/submit?url=http://mervine.net/hacks&amp;title=Hacks%20-%20mervine.net" target="_blank" title="Submit to Reddit">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Reddit.png"></a>
                </li>
                <li>
                  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://mervine.net/hacks&amp;title=Hacks%20-%20mervine.net&amp;source=http://mervine.net/hacks" target="_blank" title="Share on LinkedIn">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/LinkedIn.png"></a>
                </li>
              </ul>
<div class="list-group">
                <a class="list-group-item active" href="#">
                  <h4 class="list-group-item-heading">More on This</h4>
                </a>
                <a class="list-group-item" href="/bash-one-liners">Bash One Liners</a>
                <a class="list-group-item" href="/notes/zshrc-pry-or-irb">Choosing between Pry or IRB</a>
                <a class="list-group-item" href="/notes/install-nginx-via-yum">Install Nginx via yum</a>
                <a class="list-group-item" href="/notes/perf_rb">Simple Perf Script - perf.rb</a>
              </div>
              <div class="list-group">
<a class="list-group-item active" href="http://joshua.mervine.net/">
                  <h4 class="list-group-item-heading">Joshua P. Mervine</h4>
                </a><a class="list-group-item" href="http://twitter.com/mervinej">Twitter</a>
            <a class="list-group-item" href="http://linkedin.com/in/mervinej">Linkedin</a>
            <a class="list-group-item" href="http://github.com/jmervine">Github</a>
            <a class="list-group-item" href="http://www.gittip.com/jmervine">Gittip</a>
              </div>
            </div>
        </div>
      </div>
      <center>
        <br><div id="footer">
            <div class="container">
              <p class="muted credit">
                Powered by Nesta, a
                <a href="http://nestacms.com">Ruby CMS</a>.
              </p>
            </div>
          </div>
      </center>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script async src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js" type="text/javascript"></script><script>
      var searchElement = 'input[name=q]';
    </script><script async src="//cdn.jsdelivr.net/jquery.webpage-vim/0.1/vim.min.js" type="text/javascript"></script><script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-32343843-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
</body>
</html>
