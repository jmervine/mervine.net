<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content='&gt; *"[Httperf](http://www.hpl.hp.com/research/linux/httperf/) -- a tool for measuring web server performance. It provides a flexible facility for generating various HTTP workloads and for measuring server performance. The focus of httperf is not on implementing one particular benchmark but on providing a robust, high-performance tool that facilitates the construction of both micro- and macro-level benchmarks. The three distinguishing characteristics of httperf are its robustness, which includes the ability to generate and sustain server overload, support for the HTTP/1.1 and SSL protocols, and its extensibility to new workload generators and performance measurements."*' name="description">
<meta content="httperf, httperfrb, rubyhttperf 0 9 1 with individual connection times, automating performance testing with httperfrb" name="keywords">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="" name="author">
<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="//cdn.mervine.net/bootstrap/master.css" media="screen" rel="stylesheet">
<!--[if lte IE 6]>
      <link href='http://universal-ie6-css.googlecode.com/files/ie6.1.1.css' media='screen, projection' rel='stylesheet'>
    <![endif]--><!--[if lt IE 9]>
      <script src='//html5shim.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]--><link href="/articles.xml" rel="alternate" type="application/atom+xml">
<link href="//cdn.mervine.net/bootstrap/favicon.ico" rel="shortcut icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon.png" rel="apple-touch-icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">
<title>Performance Testing with Httperf</title>
</head>
<body style="padding-top: 10px !important">
    <div class="container">
      <div class="navbar navbar-default navbar-top" style="margin-bottom: 0px !important">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Home</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
<li class="">
              <a href="http://mervine.net/categories">Category List</a>
            </li>
            <li class="">
              <a href="http://mervine.net/projects">My Projects</a>
            </li>
            <li class="">
              <a href="http://mervine.net/notes">Notes</a>
            </li>
            <li class="">
              <a href="http://mervine.net/hacks">Hacks</a>
            </li>
            <li class="">
              <a href="http://mervine.net/quotes">Quotes</a>
            </li>
            <li class="">
              <a href="http://mervine.net/archive">Archives</a>
            </li>
          </ul>
<ul class="nav navbar-nav navbar-right visible-xs">
<li>
              <a href="http://twitter.com/mervinej">Twitter</a>
            </li>
            <li>
              <a href="http://linkedin.com/in/mervinej">Linkedin</a>
            </li>
            <li>
              <a href="http://github.com/jmervine">Github</a>
            </li>
            <li>
              <a href="http://www.gittip.com/jmervine">Gittip</a>
            </li>
          </ul>
</div>
      </div>
      <div class="container">
        <div class="page-header" style="margin-top: 0px !important;">
          <img src="http://www.gravatar.com/avatar/ed808193b8c2c8516715816f90a005b2.jpg?s=75" style="padding:5px 15px 15px; float:left"><a href="http://mervine.net/">
            <h1>mervine.net</h1>
          </a><small>Lessons learned, code written, hacks, etc.</small>
        </div>
      </div>
      <div class="container">
        <div class="col-sm-12 col-md-9">
          <div class="page_content container">
  <div class="page_content">
    <h1>Performance Testing with Httperf</h1>

<h3>Introduction</h3>

<blockquote>
<p><em>"<a href="http://www.hpl.hp.com/research/linux/httperf/">Httperf</a> -- a tool for measuring web server performance. It provides a flexible facility for generating various HTTP workloads and for measuring server performance. The focus of httperf is not on implementing one particular benchmark but on providing a robust, high-performance tool that facilitates the construction of both micro- and macro-level benchmarks. The three distinguishing characteristics of httperf are its robustness, which includes the ability to generate and sustain server overload, support for the HTTP/1.1 and SSL protocols, and its extensibility to new workload generators and performance measurements."</em></p>

<p><em>Source: <a href="http://www.hpl.hp.com/research/linux/httperf/">Httperf Homepage</a></em></p>
</blockquote>

<h5>Httperf's Default Scope</h5>

<p>It's important to note that by default httperf only tests the standard http payload of your application -- e.g. the rendered HTML of the URL you are testing. Much like "curl", it does not load assets (images, javascript or css) by default. In this document, I will be referring to this as the "<strong>base payload</strong>". There are ways to configure it to load additional requests as part of the same session, which I will be covering.</p>

<h4>Sections:</h4>

<ul>
<li><a href="#standard_usage">Standard Usage</a></li>
<li><a href="#testing_pages_with_ajax">Testing Pages with AJAX</a></li>
<li><a href="#replaying_production_logs">Replaying Production Logs</a></li>
<li><a href="#best_practices">Best Practices</a></li>
</ul>
<p><a name="standard_usage"></a></p>

<h3>Standard Usage</h3>

<p><strong>Basic command-line usage:</strong></p>

<pre class="twilight">$ httperf --server mervine.net --port 80 --num-conns 10 --rate 1
</pre>

<p><strong>Results:</strong></p>

<pre class="twilight">httperf --client=0/1 --server=mervine.net --port=80 --uri=/ --rate=1 \
  --send-buffer=4096 --recv-buffer=16384 --num-conns=10 --num-calls=1

Maximum connect burst length: 1

Total: connections 10 requests 10 replies 10 test-duration 9.286 s

Connection rate: 1.1 conn/s (928.6 ms/conn, &lt;=1 concurrent connections)
Connection time [ms]: min 284.2 avg 303.2 max 376.2 median 284.5 stddev 38.4
Connection time [ms]: connect 91.8
Connection length [replies/conn]: 1.000

Request rate: 1.1 req/s (928.6 ms/req)
Request size [B]: 68.0

Reply rate [replies/s]: min 1.0 avg 1.0 max 1.0 stddev 0.0 (1 samples)
Reply time [ms]: response 99.1 transfer 112.3
Reply size [B]: header 241.0 content 29147.0 footer 0.0 (total 29388.0)
Reply status: 1xx=0 2xx=10 3xx=0 4xx=0 5xx=0

CPU time [s]: user 1.99 system 7.27 (user 21.5% system 78.3% total 99.7%)
Net I/O: 31.0 KB/s (0.3*10^6 bps)

Errors: total 0 client-timo 0 socket-timo 0 connrefused 0 connreset 0
Errors: fd-unavail 0 addrunavail 0 ftab-full 0 other 0
</pre>

<blockquote></blockquote>

<p>In this example, I'm running ten connections <em>[--num-conns 10]</em> through <a href="http://mervine.net/">mervine.net</a> <em>[--server mervine.net]</em> at a rate of one connection per second <em>[--rate 1]</em>.</p>

<p>Breaking down the results, I typically focus on the following rows:</p>

<ol>
<li>"Connection rate" -- this is mostly useful when not passing "--rate", which sends connections as fast as possible.</li>
<li>"Connection time [ms]" -- this is the meat of the test. It's a breakdown of various metrics related to the test against your base payload.</li>
<li>"Reply size" -- this is useful when testing change which are geared towards reducing the base payload of your application. Things like adding 'gzip' compression, uglifying JavaScript or 'haml', etc.</li>
<li>"Reply status" -- it's important to ensure that you're getting 200's when testing (or perhaps 302s if that's expected).</li>
</ol>
<h4>Being a Hog!</h4>

<p>While my examples don't include this, using the "--hog" flag when running httperf on a host dedicated to generating load is a very good idea. This tells httperf to use as many TCP connections as possible, thus avoiding bottlenecks. This flag should probably be omitted if generating load on the same box your application is running on.</p>

<p><a name="testing_pages_with_ajax"></a></p>

<h3>Testing Pages with AJAX</h3>

<p>In more advanced usages you can create a a series of URIs to pass to emulate a single session. This is particularly useful when you're performance testing a page with several AJAX calls.</p>

<p>To do this, you need to create a connections file with all URIs you want to hit.</p>

<p><strong>sessions.log</strong></p>

<pre class="twilight">/
    /foo
    /bar
    /bah
</pre>

<p>You then need specify the log file you want to use in the place of "--uri" to tell 'httperf' what paths to use.</p>

<pre class="twilight">httperf --server mervine.net --wsesslog 10,1,sessions.log
</pre>

<p>Obviously, I'm not implementing "/foo", "/bar" and "/bah" as AJAX on my site, but you get the idea.</p>

<p>So what am I doing here? With "--wsesslog", the first to field is the number of connections to make, basically the same as "--num-conns" from the previous example. The second field is defined as "burst-to-burst user think time", which most simply means the number of times to access the URI before moving on to the next -- e.g. 1 would be one request per cycle through the list, 0.25 would be four requests per cycle through the list.</p>

<p>Okay, simple enough. So what does 'httperf' do with that? Well instead of trying to explain it myself, I'm going quote  <a href="http://www.hpl.hp.com/research/linux/httperf/httperf-man.txt">httperf's man page</a>; <em>"When --wsess or --wsesslog is specified, httperf generates and measures sessions instead of individual calls and additional statistics are printed at the end of a test."</em></p>

<p><a name="replaying_production_logs"></a></p>

<h3>Replaying Production Logs</h3>

<p>Httperf makes replaying production logs somewhat simple with the "--wlog" option, which is used to generate a sequence of URIs to access. The one oddity, and why I say "somewhat simple" is that it expects an ASCII NUL separated [\0] file (as opposed to "new line" separated [\n], see examples below for details).</p>

<p>The first step is to generate your list. I use <a href="/tag/nginx">Nginx</a>, so that's what I'm going to focus on here. That said, this should be pretty adaptable to most web servers. Here's the command I use to generate a traffic log from Nginx's access.log:</p>

<pre class="twilight">$ awk '{ print $7 }' /path/to/logs/access.log &gt; urls.log
</pre>

<p>This assumes -- of course -- that your request path is in the seventh column.</p>

<p>In rare caces you need to clean up a leading or trailing quote like so:</p>

<pre class="twilight">$ awk '{ print $7 }' /path/to/logs/access.log | sed 's/^\"//g' | \
  sed 's/\"$//g' &gt; urls.log
</pre>

<p>So with that, we have a list of URIs from <a href="http://mervine.net/">mervine.net</a>, which we've called "urls.log". From this, we need to generate a file which is ASCII NUL separated which we'll call "wlog.log":</p>

<p>Start with urls.log.</p>

<pre class="twilight">/
/tag
/tag/ruby
/archive
/2012
/2012/07
</pre>

<p>Convert it to wlog.log -- replace line breaks with ASCII NUL characters.</p>

<pre class="twilight">$ tr "\n" "\0" &lt; urls.log &gt; wlog.log
</pre>

<p>Now we can run our test.</p>

<pre class="twilight">$ httperf --server mervine.net --wlog Y,wlog.log
</pre>

<p>Note, the "Y" (or "N") switch is simply telling httperf to loop through the urls in your log file (or not). Additionally, you have to pass <code>--num-conns</code> with the number of connections your want to run, a simple way to do this is <code>--num-conns $( wc -l urls.log  )</code>.</p>

<p><a name="best_practices"></a></p>

<h3>Best Practices</h3>

<p>I don't claim to be an expert in this area (<strong>AT ALL</strong>), however, here a few things I've picked up in my travels, which has made my life easier in regards to performance testing best practices. They aren't always hard rules and I've broken all of them out of necessity at one point or another.</p>

<ol>
<li>Don't performance test against production applications!</li>
<li>Don't performance test against production services!</li>
<li>Don't performance test against production databases!</li>
<li><strong>Don't performance test against production ANYTHING!</strong></li>
<li>If possible, try to performance test in an environment which is identical to production in every way -- same configuration, same network, same OS, same hardware (including CPU, RAM, etc.) -- to make your tests as accurate as possible.</li>
<li>Whenever possible, generate load (i.e. run httperf) on a separate machine from the host that the application is running on. This seems like a no-brainer, but you'd be surprised…</li>
<li>Use "--hog" any time you're generating load from a separate host and your request rate is high. Eat up those TCP connections, don't be shy!</li>
<li>Generating load from an external connection can be good to test your overall network latency, but be sure your starting point connection can handle large amounts of traffic. For example, generating 100,000 connections at 100QPS from a Cable or DSL line probably isn't the best idea.</li>
<li>Oh and <strong>don't performance test against production!</strong>
</li>
</ol>
<hr class="article_seperator">
<header><h2>Articles on Performance Testing with Httperf</h2>
    </header><div class="well" style="padding-top: 0px; padding-bottom: 0px">
      <header><h2>
          <a href="http://mervine.net/httperf-0-9-1-with-individual-connection-times">httperf-0.9.1 with individual connection times</a>
        </h2>
      </header><p>This past weekend I dabbled in C++ for the first time patching httperf to use display each connection's timing when using verbose mode.</p>
      <p class="read_more">
        <a href="http://mervine.net/httperf-0-9-1-with-individual-connection-times">Continue reading</a>
      </p>
      <footer><p class="meta">
          Published
          on
          <time datetime="2012-08-13T19:36:00+00:00" pubdate>13 August 2012</time>
          in
          <a href="http://mervine.net/performance-testing-with-httperf">Performance Testing with Httperf</a>,
          <a href="http://mervine.net/ruby">Ruby</a>
        </p>
      </footer>
</div>
    <div class="well" style="padding-top: 0px; padding-bottom: 0px">
      <header><h2>
          <a href="http://mervine.net/automating-performance-testing-with-httperfrb">Automating Performance Testing with httperfrb</a>
        </h2>
      </header><p>Here I'm going to cover basic usage for <a href="https://rubygems.org/gems/httperfrb">httperfrb</a>, which I wrote to assist in automating performance testing with <a href="/tag/httperf">httperf</a>. It's important to note that it is designed as an interface to httperf and not a full feature automation suite.</p>
      <p class="read_more">
        <a href="http://mervine.net/automating-performance-testing-with-httperfrb">Continue reading</a>
      </p>
      <footer><p class="meta">
          Published
          on
          <time datetime="2012-08-10T16:14:00+00:00" pubdate>10 August 2012</time>
          in
          <a href="http://mervine.net/httperf">Httperf</a>,
          <a href="http://mervine.net/httperfrb">HTTPerf.rb</a>,
          <a href="http://mervine.net/performance-testing-with-httperf">Performance Testing with Httperf</a>,
          <a href="http://mervine.net/ruby">Ruby</a>
        </p>
      </footer>
</div>
    <footer><p class="meta">
        Published
        on
        <time datetime="2012-07-30T14:36:00+00:00" pubdate>30 July 2012</time>
        in
        <a href="http://mervine.net/httperf">Httperf</a>,
        <a href="http://mervine.net/httperfrb">HTTPerf.rb</a>,
        <a href="http://mervine.net/ruby">Ruby</a>
      </p>
    </footer><hr class="article_seperator">
<br><div id="disqus_thread">
      <script async src="http://rubyops.disqus.com/embed.js" type="text/javascript"></script><noscript>
        <a href="http://rubyops.disqus.com/embed.js?url=ref">View comments.</a>
      </noscript>
    </div>
  </div>
</div>
        </div>
        <div class="col-md-3 visible-md visible-lg">
          <div class="sidebar-nav">
              <ul class="share-buttons">
<li>
                  <a href="https://www.facebook.com/sharer/sharer.php?u=http://mervine.net/performance-testing-with-httperf" target="_blank">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Facebook.png"></a>
                </li>
                <li>
                  <a href="https://twitter.com/intent/tweet?url=http://mervine.net/performance-testing-with-httperf&amp;text=Performance%20Testing%20with%20Httperf%20-%20&amp;via=mervinej" target="_blank" title="Tweet">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Twitter.png"></a>
                </li>
                <li>
                  <a href="https://plus.google.com/share?url=http://mervine.net/performance-testing-with-httperf" target="_blank" title="Share on Google+">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Google.png"></a>
                </li>
                <li>
                  <a href="http://www.reddit.com/submit?url=http://mervine.net/performance-testing-with-httperf&amp;title=Performance%20Testing%20with%20Httperf" target="_blank" title="Submit to Reddit">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Reddit.png"></a>
                </li>
                <li>
                  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://mervine.net/performance-testing-with-httperf&amp;title=Performance%20Testing%20with%20Httperf&amp;source=http://mervine.net/performance-testing-with-httperf" target="_blank" title="Share on LinkedIn">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/LinkedIn.png"></a>
                </li>
              </ul>
<div class="list-group">
<a class="list-group-item active" href="http://joshua.mervine.net/">
                  <h4 class="list-group-item-heading">Joshua P. Mervine</h4>
                </a><a class="list-group-item" href="http://twitter.com/mervinej">Twitter</a>
            <a class="list-group-item" href="http://linkedin.com/in/mervinej">Linkedin</a>
            <a class="list-group-item" href="http://github.com/jmervine">Github</a>
            <a class="list-group-item" href="http://www.gittip.com/jmervine">Gittip</a>
              </div>
            </div>
        </div>
      </div>
      <center>
        <br><div id="footer">
            <div class="container">
              <p class="muted credit">
                Powered by Nesta, a
                <a href="http://nestacms.com">Ruby CMS</a>.
              </p>
            </div>
          </div>
      </center>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script async src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js" type="text/javascript"></script><script>
      var searchElement = 'input[name=q]';
    </script><script async src="//cdn.jsdelivr.net/jquery.webpage-vim/0.1/vim.min.js" type="text/javascript"></script><script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-32343843-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
</body>
</html>
