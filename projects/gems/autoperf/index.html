<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="Autoperf is a ruby driver for httperf, designed to help you automate load and performance testing of any web application - for a single end point, or through log replay." name="description">
<meta content="autobench, httperf, httperfrb, gems, ruby" name="keywords">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="" name="author">
<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="//cdn.mervine.net/bootstrap/master.css" media="screen" rel="stylesheet">
<!--[if lte IE 6]>
      <link href='http://universal-ie6-css.googlecode.com/files/ie6.1.1.css' media='screen, projection' rel='stylesheet'>
    <![endif]--><!--[if lt IE 9]>
      <script src='//html5shim.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]--><link href="/articles.xml" rel="alternate" type="application/atom+xml">
<link href="//cdn.mervine.net/bootstrap/favicon.ico" rel="shortcut icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon.png" rel="apple-touch-icon">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
<link href="//cdn.mervine.net/bootstrap/images/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">
<title>Autoperf (w/ HTTPerf.rb)</title>
</head>
<body style="padding-top: 10px !important">
    <div class="container">
      <div class="navbar navbar-default navbar-top" style="margin-bottom: 0px !important">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Home</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
<li class="">
              <a href="http://mervine.net/categories">Category List</a>
            </li>
            <li class="">
              <a href="http://mervine.net/projects">My Projects</a>
            </li>
            <li class="">
              <a href="http://mervine.net/notes">Notes</a>
            </li>
            <li class="">
              <a href="http://mervine.net/hacks">Hacks</a>
            </li>
            <li class="">
              <a href="http://mervine.net/quotes">Quotes</a>
            </li>
            <li class="">
              <a href="http://mervine.net/archive">Archives</a>
            </li>
            <li>
              <a href="https://github.com/jmervine/autoperf">Fork me on Github</a>
            </li>
          </ul>
<ul class="nav navbar-nav navbar-right visible-xs">
<li>
              <a href="http://twitter.com/mervinej">Twitter</a>
            </li>
            <li>
              <a href="http://linkedin.com/in/mervinej">Linkedin</a>
            </li>
            <li>
              <a href="http://github.com/jmervine">Github</a>
            </li>
            <li>
              <a href="http://www.gittip.com/jmervine">Gittip</a>
            </li>
          </ul>
</div>
      </div>
      <div class="container">
        <div class="page-header" style="margin-top: 0px !important;">
          <img src="http://www.gravatar.com/avatar/ed808193b8c2c8516715816f90a005b2.jpg?s=75" style="padding:5px 15px 15px; float:left"><a href="http://mervine.net/">
            <h1>mervine.net</h1>
          </a><small>Lessons learned, code written, hacks, etc.</small>
        </div>
      </div>
      <div class="container">
        <div class="col-sm-12 col-md-9">
          <div class="page_content container">
  <div class="page_content">
    <h1>Autoperf (w/ HTTPerf.rb)</h1>

<p><img src="https://badge.fury.io/rb/autoperf.png" alt="Gem Version"> Â  <img src="https://travis-ci.org/jmervine/autoperf.png?branch=master" alt="Build Status"></p>

<p>Autoperf is a ruby driver for <a href="http://mervine.net/httperf">httperf</a>, designed to help you automate load and performance
testing of any web application - for a single end point, or through log replay.</p>

<p>This has been refactored from the original -- <a href="https://github.com/igrigorik/autoperf">github.com/igrigorik/autoperf</a>
-- to include <a href="http://mervine.net/gems/httperfrb">HTTPerf.rb</a> as a simplification and to include additional features.
This has been refactored and released with permission from <a href="http://www.igvita.com/">Ilya Grigorik</a>, the original author.</p>

<p>More info on the original Autoperf: <a href="http://www.igvita.com/2008/09/30/load-testing-with-log-replay/">http://www.igvita.com/2008/09/30/load-testing-with-log-replay/</a>.</p>

<h3>Requirements</h3>

<p>To get started, first download &amp; install httperf: <a href="http://www.hpl.hp.com/research/linux/httperf/">http://www.hpl.hp.com/research/linux/httperf/</a>.</p>

<p>Or for HTTPerf.rb percentile support, install this fork: <a href="http://github.com/jmervine/httperf">http://github.com/jmervine/httperf</a>.</p>

<h4>Rubies</h4>

<p>It's important to note that tests pass for this on the following <a href="http://mervine.net/ruby">Ruby</a> versions, but I've only used this at length on 1.9.2p290.</p>

<ul>
<li>1.9.3p392</li>
<li>2.0.0p0</li>
</ul>
<blockquote><p>Note:
I was also able to get tests to pass on 1.8.7 and 1.9.2, but not on Traivs and I would consider it unstable on both.</p></blockquote>

<h3>Installation</h3>

<pre class="twilight">gem install bundler
echo <span class="String"><span class="String">'</span>gem "autoperf"<span class="String">'</span></span> <span class="Keyword">&gt;&gt;</span> Gemfile
bundle install
</pre>

<p>Without bundler:</p>

<pre class="twilight">gem install autoperf
</pre>

<p>From source:</p>

<pre class="twilight">git clone git://github.com/rubyops/autoperf.git
cd autoperf
gem build autoperf.gemspec
gem install ./autoperf-VERSION.gem
</pre>

<h3>Usage</h3>

<p>Next, either run a simple test straight from the command line (man httperf), or create
an execution plan for autoperf. If you want to replay an access log from your production
environment, follow these steps:</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> grab last 10000 lines from nginx log, and extract a certain pattern (if needed)</span>
tail -n 10000 nginx.log <span class="Keyword">|</span> bundle exec make_replay_log <span class="Keyword">&gt;</span> replay_log
</pre>

<p>Next, configure your execution plan (see <a href="https://github.com/rubyops/autoperf/blob/master/config/sample.yml">sample.yml</a>), and run autoperf:</p>

<pre class="twilight">bundle exec autoperf -c sample.yml
</pre>

<p>Sample output:</p>

<pre class="twilight">+-------------------------------------------------------------------------------------------------------------------------------+
| rate | connection_rate_per_sec | request_rate_per_sec | connection_time_avg | errors_total | reply_status_5xx | net_io_kb_sec |
+-------------------------------------------------------------------------------------------------------------------------------+
|    5 | 154.4                   | 154.4                | 6.5                 | 0            | 0                | 1176.9        |
|   10 | 153.4                   | 153.4                | 6.5                 | 0            | 0                | 1169.5        |
|   15 | 153.0                   | 153.0                | 6.5                 | 0            | 0                | 1166.6        |
|   20 | 147.4                   | 147.4                | 6.8                 | 0            | 0                | 1123.4        |
+-------------------------------------------------------------------------------------------------------------------------------+
</pre>

<p>If your server uses caching, making it pointless to run the same requests over
and over, you can use different requests for each run.</p>

<pre class="twilight"><span class="Comment"><span class="Comment">#</span> Create 10 1000-line files (xa, xb, xc etc)</span>
split -a 1 requests_path

<span class="Comment"><span class="Comment">#</span> Convert to null-terminated strings</span>
<span class="Keyword">for</span> x <span class="Keyword">in</span> x?<span class="Keyword">;</span> <span class="Keyword">do</span> tr <span class="String"><span class="String">"</span>\n<span class="String">"</span></span> <span class="String"><span class="String">"</span>\0<span class="String">"</span></span> <span class="Keyword">&lt;</span> <span class="Variable"><span class="Variable">$</span>x</span> <span class="Keyword">&gt;</span> <span class="Variable"><span class="Variable">$</span>x</span>.nul<span class="Keyword">;</span> <span class="Keyword">done</span>

<span class="Comment"><span class="Comment">#</span> run as before, but use the `wlog` line instead of `httperf_wlog` in the conf file</span>
autoperf -c sample.yml
</pre>
    
    <hr class="article_seperator">
<br><div id="disqus_thread">
      <script async src="http://rubyops.disqus.com/embed.js" type="text/javascript"></script><noscript>
        <a href="http://rubyops.disqus.com/embed.js?url=ref">View comments.</a>
      </noscript>
    </div>
  </div>
</div>
        </div>
        <div class="col-md-3 visible-md visible-lg">
          <div class="sidebar-nav">
              <ul class="share-buttons">
<li>
                  <a href="https://www.facebook.com/sharer/sharer.php?u=http://mervine.net/projects/gems/autoperf" target="_blank">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Facebook.png"></a>
                </li>
                <li>
                  <a href="https://twitter.com/intent/tweet?url=http://mervine.net/projects/gems/autoperf&amp;text=Autoperf%20(w/%20HTTPerf.rb)%20-%20&amp;via=mervinej" target="_blank" title="Tweet">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Twitter.png"></a>
                </li>
                <li>
                  <a href="https://plus.google.com/share?url=http://mervine.net/projects/gems/autoperf" target="_blank" title="Share on Google+">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Google.png"></a>
                </li>
                <li>
                  <a href="http://www.reddit.com/submit?url=http://mervine.net/projects/gems/autoperf&amp;title=Autoperf%20(w/%20HTTPerf.rb)" target="_blank" title="Submit to Reddit">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/Reddit.png"></a>
                </li>
                <li>
                  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://mervine.net/projects/gems/autoperf&amp;title=Autoperf%20(w/%20HTTPerf.rb)&amp;source=http://mervine.net/projects/gems/autoperf" target="_blank" title="Share on LinkedIn">
                    <img src="//cdn.mervine.net/bootstrap/images/simple_icons/LinkedIn.png"></a>
                </li>
              </ul>
<div class="list-group">
                <a class="list-group-item active" href="#">
                  <h4 class="list-group-item-heading">More on This</h4>
                </a>
                <a class="list-group-item" href="/projects/gems/autobench">Autobench [alpha release]</a>
                <a class="list-group-item" href="/projects/gems/httperfrb">HTTPerf.rb</a>
              </div>
              <div class="list-group">
<a class="list-group-item active" href="http://joshua.mervine.net/">
                  <h4 class="list-group-item-heading">Joshua P. Mervine</h4>
                </a><a class="list-group-item" href="http://twitter.com/mervinej">Twitter</a>
            <a class="list-group-item" href="http://linkedin.com/in/mervinej">Linkedin</a>
            <a class="list-group-item" href="http://github.com/jmervine">Github</a>
            <a class="list-group-item" href="http://www.gittip.com/jmervine">Gittip</a>
              </div>
            </div>
        </div>
      </div>
      <center>
        <br><div id="footer">
            <div class="container">
              <p class="muted credit">
                Powered by Nesta, a
                <a href="http://nestacms.com">Ruby CMS</a>.
              </p>
            </div>
          </div>
      </center>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script async src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js" type="text/javascript"></script><script>
      var searchElement = 'input[name=q]';
    </script><script async src="//cdn.jsdelivr.net/jquery.webpage-vim/0.1/vim.min.js" type="text/javascript"></script><script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-32343843-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
</body>
</html>
